# 开发与联调约定（MoonLens 后端）

适用范围
- 本仓库（MoonLens-server）所有 Spec 与实现活动。

规范遵循
- 架构一致性：所有 Requirements/Design/Tasks 必须遵循 `docs/` 目录下的架构/实现文档（含 Architecture-Overview、技术实现、零持久化、GitLab 集成等）。若 Spec 与 docs 存在冲突，以 docs 为准，先修订/对齐 Spec 再实施。
- 审批门禁：Requirements → Design → Tasks 必须走 approvals；实施阶段在 tasks.md 中用 `[ ]`/`[-]`/`[x]` 标记状态并保持溯源。

本地调试
- 启动命令：统一使用 `npm run start:dev`（Nest watch）。快速验证可临时 `npm run start`，团队默认 `start:dev`。
- 端口与健康：默认 `3000`；健康检查 `GET /api/health`；Swagger `GET /api-docs`。
- 依赖服务：MySQL/Redis 可用 `docker compose up -d mysql redis`；数据库同步优先 `npx prisma db push`（避免影子库权限问题）。

联调前置
- 必读文档：
  - `docs/前后端联调指南.md`
  - `docs/gitlab-integration.md`、`docs/GitLab-OAuth配置.md`
  - `docs/authentication.md`
  - 根 `README.md` 与 `Architecture-Overview.md`
- 前端配置：同级 `../MoonLens-client/.env.local` 设置 `VITE_API_BASE_URL=http://localhost:3000`。

安全与默认
- 零持久化：不持久化源码；仅存结构化结果与指标；日志脱敏。
- 最小权限：令牌加密存储；Webhook 校验开启；敏感配置通过环境变量/密管注入。

PR 提交清单
- 说明已对齐 `docs/` 架构文档与 Spec 审批 ID；
- 影响范围与回滚方案；
- 联调说明（接口、用例、注意事项）与是否更新/引用联调文档。

